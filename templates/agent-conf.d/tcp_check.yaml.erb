# Managed by Puppet
#
init_config:

instances:
<%- (Array(@_instances)).each do |instance| -%>
  - name: <%= instance['name'] %>
    host: <%= instance['host'] %>
    port: <%= instance['port'] %>
    timeout: <%= instance['timeout'] %>

    # The (optional) window and threshold parameters allow you to trigger
    # alerts only if the check fails x times within the last y attempts
    # where x is the threshold and y is the window.
    #
  <%- if instance['threshold'] -%>
    threshold: <%= instance['threshold'] %>
  <%- end %>
  <%- if instance['window'] -%>
    window: <%= instance['window'] %>
  <%- end -%>

    # The (optional) collect_response_time parameter will instruct the
    # check to create a metric 'network.tcp.response_time', tagged with
    # the url, reporting the response time in seconds.
    #
  <%- if instance['collect_response_time'] -%>
    collect_response_time: <%= instance['collect_response_time'] %>
  <%- end -%>
    tags:
  <%- Array(instance['tags']).each do |tag| -%>
    <%- if tag != '' -%>
      - <%= tag %>
    <%- end -%>
  <%- end -%>
    # The (optional) skip_event parameter will instruct the check to not
    # create any event to avoid duplicates with a server side service check.
    # This default to False.
    #
  <%- if instance['skip_event'] -%>
    skip_event: <%= instance['skip_event'] %>
  <%- end -%>
<%- end -%>
  # - name: My second service
  #   host: 127.0.0.1
  #   port: 80
